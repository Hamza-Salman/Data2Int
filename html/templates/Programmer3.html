<!DOCTYPE html>
<meta charset="ISO-8859-1">
{% extends "base.html" %}
{% block title %}Programmmer3 Archives{% endblock%}

{% block content %}
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
</head>
<h2> Code Changes - Edited By HS</h2>

<h1>Progress Update</h1><br>
<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="pills-updates-tab" data-toggle="pill" href="#pills-updates" role="tab" aria-controls="pills-d3script" aria-selected="true">Basic Updates</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-files-tab" data-toggle="pill" href="#pills-files" role="tab" aria-controls="pills-gantt" aria-selected="false">Uploading Files to Website</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-geo-tab" data-toggle="pill" href="#pills-geo" role="tab" aria-controls="pills-geoInfo" aria-selected="false">Updating Geo Map</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-geomap-tab" data-toggle="pill" href="#pills-geomap" role="tab"
       aria-controls="pills-geomap" aria-selected="false">Creating Geo Map</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-map-tab" data-toggle="pill" href="#pills-map" role="tab"
       aria-controls="pills-map" aria-selected="false">Map</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-file-type-tab" data-toggle="pill" href="#pills-fileType" role="tab" aria-controls="pills-fileTypeInfo" aria-selected="false">File Upload Research</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-json-type-tab" data-toggle="pill" href="#pills-filejson" role="tab" aria-controls="pills-fileTypeInfo" aria-selected="false">JSON Upload</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-perProject-tab" data-toggle="pill" href="#pills-personalProject" role="tab" aria-controls="pills-personalProject" aria-selected="false">Personal Project</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-fileupload-tab" data-toggle="pill" href="#pills-fileupload" role="tab"
       aria-controls="pills-fileupload" aria-selected="false">File Uploads</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-visualizations-tab" data-toggle="pill" href="#pills-visualizations" role="tab"
       aria-controls="pills-visualizations" aria-selected="false">D3 Visualizations</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-datagathering-tab" data-toggle="pill" href="#pills-datagathering" role="tab"
       aria-controls="pills-datagathering" aria-selected="false">Data Gathering</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-displayingvisuals-tab" data-toggle="pill" href="#pills-displayingvisuals" role="tab"
       aria-controls="pills-displayingvisuals" aria-selected="false">Displaying Visuals</a>
  </li>
</ul>
</div>
<div class="tab-content" id="pills-tabContent">
<div class="tab-pane fade show active" id="pills-updates" role="tabpanel" aria-labelledby="pills-updates-tab">
      <hr/>
      <p>-Setup Pycharm IDE to interface with the server. <br>
    -Implemented code to upload file to local directory.</p>

</div>
<div class="tab-pane fade" id="pills-files" role="tabpanel" aria-labelledby="pills-files-tab">
      <hr/>
      <h3>This section covers the implementation of the file upload feature.</h3>
        <ol>
            <li>Creating the upload page and implementing the file input form:
                <pre>
                    <code  class="language-javascript">
                        <script type="prism-html-markup">

                            <h1>Upload A File</h1>
                            <h2>Please Select a file to upload using the Choose CSV button<br>Please make sure that your CSV is saved as "CSV UTF-8 (Comma delimited)"</h2><br><br>

                            <!-- This is the code for the upload file button-->
                            <form method="post" enctype="multipart/form-data">
                                <input oninput="filesize(this);" type="file" name="file" accept=".csv"/><br><br>
                            <!--    <label style="background: #fff;color: #7386D5; height: 40px; width: 210px; display: flex; justify-content: center; align-items: center;border-radius: 5px; cursor: pointer;" for="uploadedFile">Choose CSV</label>-->
                                <input type="submit" value="Upload" id="uploadButton" style="background: #fff;color: #7386D5; height: 40px; width: 210px; border-radius: 5px;"/>
                            </form>

                            <script>
                                   function filesize(elem) {
                                        document.cookie = `filesize=${elem.files[0].size}`;
                                    }

                        </script>
                    </code>
                </pre>
            </li>
            <li>Submitting the form with file data and checking it in the main app.py file. Checking if its valid and saving it to the web server:
                <pre>
                    <code  class="language-javascript">
                        <script type="prism-python">

                            @app.route('/Upload', methods=['POST'])
def upload_file():
    if request.method == 'POST':

        # if max_filesize(request.cookies.get("filesize")):
        #     return render_template('ErrorFileUpload.html')

        uploaded_file = request.files['file']

        if uploaded_file.filename == "":
            return render_template('ErrorFileUpload.html')

        uploaded_file.save(os.path.join(app.config["UPLOAD_FOLDER"], uploaded_file.filename))
        return render_template('SuccessfulUpload.html')

@app.route('/ErrorFileUpload')
def error_file_upload():
    return render_template('ErrorFileUpload.html')

@app.route('/Upload')
def upload_file_page():
    return render_template('UploadPage.html')

@app.route('/SuccessfulUpload')
def success_file_upload():
    return render_template('SuccessfulUpload.html')

                        </script>
                    </code>
                </pre>
            </li>
        </ol>
</div>
<div class="tab-pane fade" id="pills-geo" role="tabpanel" aria-labelledby="pills-files-tab">
      <hr/>
      <h3>This section covers Uploading data for the Geo Map.</h3>
        <ol>
            <li>Issues with file size:<br>
                413 Request Entity Too Large error is displayed when trying to upload Stats Can data. The limit needs to be increased in the Njinx.conf file,
                Reference:<a style="color: blue" href="https://stackoverflow.com/questions/16312079/nginx-413-entity-too-large-file-does-not-reach-the-application"> Upload Error Info</a>
                <br><br>
                <img src="{{url_for('static', filename='NginxError.jpg')}}" alt="NginxError" style="border: 5px solid black">
            </li>
            <br>
            <li>Issues with the data: <br>
                We were unable to determine a way to properly find an element that could be used for the location element. The CSV that was requested had many subdivisions and went into high details for the different areas. They are using Dissemination area (DA) ids for detailed locations which would not be implementable on the current chart.
                Reference:<a style="color: blue" href="http://canue.ca/wp-content/uploads/2018/03/CanALE_UserGuide.pdf"> Link to the Stat Canada Website</a>
                <br><br>
                <img src="{{url_for('static', filename='provincialData.png')}}" alt="ProvintialDataCSV" style="border: 5px solid black">
                <br><br>
                The issue with this however was even with a small data set, the file would not upload. The limit is very low, and it would not cover much of the data.
            </li>
        </ol>

        <h1>HTML for GeoMap</h1>
        <pre>
            <code  class="language-javascript">
                <script type="prism-html-markup">
                    <style>
                        .province {
                            fill: #bada55;
                            stroke: black;
                            stroke-width: 0.5;
                        }
                        .selected {
                            fill: orange;
                        }
                    </style>
                    <body>
                        <div id="map"></div>
                        This is a placeholder
                        <script src="https://code.jquery.com/jquery-3.1.1.min.js"><script>
                        <script src="https://d3js.org/d3.v4.min.js"><script>
                        <script src="https://d3js.org/topojson.v1.min.js"><script>
                        <script src="/static/js/hamzaGeoMap.js"><script>
                    </body>
                </script>
            </code>
        </pre>
        <h1>JavaScript for GeoMap (hamzaGeoMap.js)</h1>
        <pre>
            <code  class="language-javascript">
                <script type="prism-javascript">
                    (function() {
                        var margin = {top: 50, left: 50, right: 50, bottom: 50},
                        height = 1000 - margin.top - margin.bottom,
                        width = 1000 - margin.left - margin.right;

                        var svg = d3.select("#map")
                            .append("svg")
                            .attr("height", height + margin.top + margin.bottom)
                            .attr("width", width + margin.left + margin.right)
                            .append("g")
                            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                        d3.queue()
                          .defer(d3.json, "/static/geojson/canada.topo.json")
                          .defer(d3.csv, "/templates/uploadedFiles/StatCanPopulationData.csv")
                          .await(ready)

                        var projection = d3.geoMercator()
                            .translate([ width, height])
                            .scale(300)

                        var path = d3.geoPath()
                            .projection(projection)


                        function ready (error, data, StatCanPopulationData) {
                            console.log(data)

                            var provinces = topojson.feature(data, data.objects.canada).features

                            console.log(provinces)

                            svg.selectAll(".province")
                                .data(provinces)
                                .enter().append("path")
                                .attr("class", "province")
                                .attr("d", path)
                                .attr("id", function(d) {
                                    return d.id;
                                })
                                .attr("title", "Province Name Placeholder")
                                .on('mouseenter', function(d){
                                    d3.select(this).classed("selected", true)
                                })
                                .on('mouseout', function(d){
                                    d3.select(this).classed("selected", false)
                                })
                                .on('click', function(d) {
                                    var thisProvince = provinces.find(x => x.id === this.id)
                                    var provinceName = thisProvince.properties.name
                                    var thisData = StatCanPopulationData.find(x => x.GEO_NAME === provinceName)
                                    var totalPopulation = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    var malePopulation = thisData["Dim: Sex (3): Member ID: [2]: Male"]
                                    var femalePopulation = thisData["Dim: Sex (3): Member ID: [3]: Female"]
                                    alert(provinceName + "\nTotal Population: " + totalPopulation + "\nMale Population: " + malePopulation + "\nFemale Population: " + femalePopulation)
                                })

                            console.log(StatCanPopulationData)

                        }

                    })();
                </script>
            </code>
        </pre>
        <h1>HTML for GeoMap with Divisions</h1>
        <pre>
            <code  class="language-javascript">
                <script type="prism-html-markup">
                    <style>
                        .division {
                            fill: #bada55;
                            stroke: black;
                            stroke-width: 0.5;
                        }
                        .selected {
                            fill: lightgray;
                        }
                        .low {
                            fill: lightyellow;
                        }
                        .lowmid {
                            fill: rgb(255, 255, 175);
                        }
                        .mid {
                            fill: rgb(255, 255, 129);
                        }
                        .midhigh {
                            fill: lightsalmon;
                        }
                        .high {
                            fill: salmon;
                        }
                        .extreme {
                            fill: darkred;
                        }
                        #map {
                            border: 1px solid #000000;
                        }
                    </style>
                    <body>
                        <div id="map" style="border:2px black;"></div>
                        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""><script>
                        <script src="https://code.jquery.com/jquery-3.1.1.min.js"><script>
                        <script src="https://d3js.org/d3.v4.min.js"><script>
                        <script src="https://d3js.org/topojson.v1.min.js"><script>
                        <script src="/static/js/hamzaGeoMap.js"><script>
                    </body>
                </script>
            </code>
        </pre>
        <h1>JavaScript for GeoMap with Divisions using database (hamzaGeoMap.js)</h1>
        <pre>
            <code  class="language-javascript">
                <script type="prism-javascript">
                    (function() {
                        var margin = {top: 50, left: 50, right: 50, bottom: 50},
                        height = 1000 - margin.top - margin.bottom,
                        width = 1000 - margin.left - margin.right;
                        
                    
                        var svg = d3.select("#map")
                            .append("svg")
                            .attr("height", height + margin.top + margin.bottom)
                            .attr("width", width*1.5 + margin.left + margin.right)
                            .append("g")
                            .attr("transform", "translate(" + width/1.5 + "," + height/2.5 + ")");
                    
                        d3.queue()
                          .defer(d3.json, "/static/geojson/canada_divisions.json")
                          .defer(d3.json, "/donorschoose/mapdata")
                          .await(ready)
                    
                        var projection = d3.geoMercator()
                            .translate([ width, height])
                            .scale(600)
                    
                        var path = d3.geoPath()
                            .projection(projection)
                    
                        function ready (error, data, mapData) {
                    
                            const g = svg.append('g')
                    
                            var divisions = topojson.feature(data, data.objects.canada_divisions).features
                    
                            console.log(divisions)
                            console.log(mapData)
                    
                            g.selectAll(".division")
                                .data(divisions)
                                .enter().append("path")
                                .attr("class", "division")
                                .attr("d", path)
                                .attr("id", function(d) {
                                    return d.properties.CDUID; 
                                })
                                .attr("colorClass", "test")
                                .classed("low", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population < 10000) {
                                        this.setAttribute("colorClass", "low")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .classed("lowmid", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population < 50000 && population >= 10000) {
                                        this.setAttribute("colorClass", "lowmid")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .classed("mid", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population < 100000 && population >= 50000) {
                                        this.setAttribute("colorClass", "mid")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .classed("midhigh", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population < 500000 && population >= 100000) {
                                        this.setAttribute("colorClass", "midhigh")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .classed("high", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population < 1000000 && population >= 500000) {
                                        this.setAttribute("colorClass", "high")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .classed("extreme", function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId)
                                    var population = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]
                                    if (population >= 1000000) {
                                        this.setAttribute("colorClass", "extreme")
                                        return true
                                    }else {
                                        return false
                                    }
                                })
                                .on('mouseenter', function(d){
                                    d3.select(this).classed("low", false)
                                    d3.select(this).classed("lowmid", false)
                                    d3.select(this).classed("mid", false)
                                    d3.select(this).classed("midhigh", false)
                                    d3.select(this).classed("high", false)
                                    d3.select(this).classed("extreme", false)
                                    d3.select(this).classed("selected", true)
                                })
                                .on('mouseout', function(d){
                                    d3.select(this).classed(this.getAttribute("colorClass"), true)
                                    d3.select(this).classed("selected", false)
                                })
                                .on('click', function(d) {
                                    var thisDivision = divisions.find(x => x.properties.CDUID === this.id)
                                    var divisionId = thisDivision.properties.CDUID
                                    var thisData = mapData.find(x => x["GEO_CODE (POR)"] === divisionId) //THIS IS NEEDED
                                    var divisonName = thisData.GEO_NAME//THIS IS NEEDED
                                    var totalPopulation = thisData["Dim: Sex (3): Member ID: [1]: Total - Sex"]//THIS IS NEEDED
                                    alert(divisonName + "\nTotal Population: " + totalPopulation)
                    
                            svg.selectAll(".division")
                                .append('title')
                                .text(d => d.properties.CDNAME)
                    
                            svg.call(d3.zoom().on('zoom', () => {
                                g.attr('transform', d3.event.transform)
                            }))
                    
                        })
                        }
                    })();
                </script>
            </code>
        </pre>
</div>
<div class="tab-pane fade" id="pills-geomap" role="tabpanel" aria-labelledby="pills-geomap-tab">
    <hr/>
    <h3>The following is the PowerPoint that walks you through the creation of a GeoMap using D3:</h3>
        <a class="btn btn-primary view-pdf" href="/templates/resources/Data_Patterns_Gantt_Chart.pdf " target="_blank">View PowerPoint</a>

</div>
<div class="tab-pane fade" id="pills-map" role="tabpanel" aria-labelledby="pills-map-tab">
    <hr/>
    <h3>Stats Can Map Operational:</h3>
    <p>This map has clickable elements that will prompt you with the 2016 StatsCan Population data for each province. (NOTE: It takes a long time to load)<br>Use scroll wheel to zoom in and out.</p>
    <style>
        .division {
            fill: #bada55;
            stroke: black;
            stroke-width: 0.5;
        }
        .selected {
            fill: lightgray;
        }
        .low {
            fill: lightyellow;
        }
        .lowmid {
            fill: rgb(255, 255, 175);
        }
        .mid {
            fill: rgb(255, 255, 129);
        }
        .midhigh {
            fill: lightsalmon;
        }
        .high {
            fill: salmon;
        }
        .extreme {
            fill: darkred;
        }
        #map {
            border: 1px solid #000000;
            max-width: 902px;
            max-height: 602px;
        }
        #tableData {
            border: 1px solid #000000;
            max-height: 602px;
            font-size: small;
        }
    </style>
    <body>
        <table>
            <tr>
                <td>
                    <div id="map"></div>
                </td>
                <td colspan="2">
                    <div id="tableData" style="overflow-y: scroll;"></div>
                </td>
            </tr>
        </table>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <script src="/static/js/hamzaGeoMap.js"></script>
    </body>

</div>
<div class="tab-pane fade" id="pills-fileType" role="tabpanel" aria-labelledby="pills-files-tab">
    <hr/>
    <h3>Pickle Python Library</h3><br>
    <p>Pickle is a library in python used for serializing and de-serializing Python object structures<br>
    This can be very useful if a user is trying to extract a large dataset from a python program.<br>
    Having this extracted data can be very useful, not only to make backups, but also to use it for analysis purposes.<br>
    An example of this would be if a user had a python program used for machine learning, they could extract this data<br>
    used for training the model and also the results produced by the Model itself.<br>
    This data can then be used as a backup for the model and also as a data set that can be used to analyze the model.</p><br>
    <h3>What data types can be pickled?</h3><br>
    <ul>
        <li>Booleans</li>
        <li>Integers</li>
        <li>Floats</li>
        <li>Complex Numbers</li>
        <li>Strings (normal and Unicode)</li>
        <li>Tuples</li>
        <li>Lists</li>
        <li>Sets</li>
        <li>Dictionaries that are built using other pickle supported data types</li>
    </ul>
    <h3>Pickle vs JSON</h3><br>
    <p>Pickle is very similar to JSON in its functionality, however there are some benefits to JSON. JSON is <br>
    language independent unlike Pickle and it is also more secure than Pickle. The advantage to Pickle however<br>
    become evident if you are solely using a Python based application as it can take the data from the Pickle<br>
    files and reconstruct objects that can be used in your program.</p><br>
    <h3>References:</h3>
    <ol>
        <li>Article that explains the Pickle library: <a style="color: blue" href="https://www.datacamp.com/community/tutorials/pickle-python-tutorial?utm_source=adwords_ppc&utm_campaignid=898687156&utm_adgroupid=48947256715&utm_device=c&utm_keyword=&utm_matchtype=b&utm_network=g&utm_adpostion=&utm_creative=229765585186&utm_targetid=dsa-429603003980&utm_loc_interest_ms=&utm_loc_physical_ms=9000684&gclid=CjwKCAjwlrqHBhByEiwAnLmYUJIltcTS6uB181crDXOkiZ4gqeZN0c8Syz36ycP0UJ4Kd4ITg29FCBoCuUgQAvD_BwE"> Here</a></li>
        <li>Video that explains the Pickle library and its uses: <a style="color: blue" href="https://www.youtube.com/watch?v=2Tw39kZIbhs"> Here</a></li>

    </ol>
</div>
<div class="tab-pane fade" id="pills-filejson" role="tabpanel" aria-labelledby="pills-files-tab">
    <hr/>
    <h3>Uploading a JSON File</h3><br>
    <p>The following shows how I uploaded a json file to MongoDB using Python.</p><br>
    <br>
    <pre>
    <code  class="language-javascript">
        <script type="prism-python">
from flask import Flask
from pymongo import MongoClient
import json

MONGODB_HOST = 'localhost'
MONGODB_PORT = 27017
DBS_NAME = 'donorschoose'

connection = MongoClient(MONGODB_HOST, MONGODB_PORT) //connects to MongoDB

database = connection[DBS_NAME] //selects the database

jsonCollection = database["jsonCollection"] //Creates a new collection

testFile = open("/var/www/data2int.com/html/templates/uploadedFiles/Test.json") //reads the input file

jsonData = json.load(testFile) //loads the data from json into a Python dictionary

for i in jsonData:
    jsonCollection.insert_many(i) //loops over dictionary and uploads into the database

//closes the file and connection
testFile.close()
connection.close()


                        </script>
                    </code>
                </pre>
    <ol>
        This script would automatically be run when an upload is called on a json file. The data would be uploaded into MongoDB for us to access.
    </ol>
    <ol>
        We tested this by just implementing it directly to a page and running the script in the main program, but ideally we would have this as a separate script.
        <pre>
        <code  class="language-javascript">
        <script type="prism-python">
@app.route('/AccessingData')
def AccessingData():
    connection = MongoClient(MONGODB_HOST, MONGODB_PORT)
    json_collection = connection[DBS_NAME]["test"]
    testfile = open("/var/www/data2int.com/html/templates/uploadedFiles/Test.json")
    json_data = json.load(testfile)
    for i in json_data:
        json_collection.insert_one(i)
    testfile.close()
    connection.close()
    return render_template('AccessingData.html')
                        </script>
                    </code>
                </pre>
    </ol>
    <ol>
        The result looks like this in MongoDB:
        <img src="{{url_for('static', filename='MongoDBtest1.jpg')}}" alt="ProvintialDataCSV" style="border: 5px solid black">
    </ol>
    <ol>
        <li>Article that explains uploading a json file using python: <a style="color: blue" href="https://www.geeksforgeeks.org/read-json-file-using-python/"> Here</a></li>
        <li>Video that explains uploading json data into MongoDB: <a style="color: blue" href="https://www.youtube.com/watch?v=rE_bJl2GAY8&t=1133s"> Here</a></li>

    </ol>
</div>
<div class="tab-pane fade" id="pills-personalProject" role="tabpanel" aria-labelledby="pills-perProject-tab">
    <hr/>
    <h1>Personal Project: Geo Map Data</h1>
    <p>For my personal project I will be taking a more in-depth look on how to create GeoMaps.<br>
       The goal for this will be to find a way to implement the ability to create GeoMaps that dont conform to regular world maps.<br>
       I want to implement the ability to work with unconventional geo data and try to create useful visualizations.<br>
       The other thing I want to look into is, how to create GeoJSON files based on custom maps.</p>

</div>
<div class="tab-pane fade" id="pills-fileupload" role="tabpanel" aria-labelledby="pills-fileupload-tab">
    <hr/>
    For the file upload process our team decided to focus on four main data types: CSV, XSLX, JSON, XML<br>
    The upload function in our main python file identifies the file type and redirects it to the correct upload function<br>
    so that the data can be uploaded into MongoDB. The following are the four files used to manage the different file type uploads.<br>

    <div class="accordion" id="accordionGuide">
        <div class="card">
            <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                            aria-expanded="true" aria-controls="collapseOne">
                        CSV
                    </button>
                </h5>
            </div>

            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionGuide">
                <div class="card-body">
                    <div class="description">
                        <pre>
                            <code  class="language-javascript">
                            <script type="prism-python">
                                from os import dup
                                from pymongo import MongoClient, collection
                                import json
                                import csv
                                import sys, getopt, pprint
                                
                                
                                def csv_upload(uploaded_file, path_to_file, duplicatesInput, DB_HOST, DB_PORT, DB_Name):
                                    COLLECTION_NAME = uploaded_file.split('.')[0]
                                
                                    connection = MongoClient(DB_HOST, DB_PORT)
                                
                                    collection = connection[DB_Name][COLLECTION_NAME]
                                    csvFile = open(path_to_file + "/" + uploaded_file, 'r')
                                    reader = csv.DictReader(csvFile)
                                
                                    if (duplicatesInput == "NoDupes"):
                                        #print(reader)
                                        no_dupes = []
                                        for each in reader:
                                            if each not in no_dupes:
                                                no_dupes.append(each)
                                                
                                        collection.insert_many(no_dupes)
                                    else:
                                        collection.insert_many(reader)
                                
                                            </script>
                                        </code>
                                    </pre>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingTwo">
                    <h5 class="mb-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            XLSX
                        </button>
                    </h5>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                    <div class="card-body">
                        <div class="guide">
                            <pre>
                                <code  class="language-javascript">
                                <script type="prism-python">
                                    from pymongo import MongoClient, collection
import pandas as pd
import json
import csv
import sys, getopt, pprint


def xlsx_upload(uploaded_file, path_to_file, duplicatesInput, DB_HOST, DB_PORT, DB_Name):
    COLLECTION_NAME = uploaded_file.split('.')[0]

    connection = MongoClient(DB_HOST, DB_PORT)

    collection = connection[DB_Name][COLLECTION_NAME]

    excel_file = pd.read_excel(path_to_file + "/" + uploaded_file, engine='openpyxl', index_col=None)

    excel_file.to_csv(path_to_file + "/" + COLLECTION_NAME + ".csv", encoding='utf-8', index=False)

    csvFile = open(path_to_file + "/" + COLLECTION_NAME + ".csv", 'r')
    reader = csv.DictReader(csvFile)

    if (duplicatesInput == "NoDupes"):
        #print(reader)
        no_dupes = []
        for each in reader:
            if each not in no_dupes:
                no_dupes.append(each)
                
        collection.insert_many(no_dupes)
    else:
        collection.insert_many(reader)
                                    </script>
                                </code>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingThree">
                    <h5 class="mb-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            JSON
                        </button>
                    </h5>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingThree"
                     data-parent="#accordionExample">
                    <div class="card-body">
                        <pre>
                            <code  class="language-javascript">
                            <script type="prism-python">
                                from pymongo import MongoClient, collection
import json

def json_upload(json_data, uploaded_file, duplicatesInput, DB_HOST, DB_PORT, DB_Name):
    COLLECTION_NAME = uploaded_file.split('.')[0]

    connection = MongoClient(DB_HOST, DB_PORT)

    collection = connection[DB_Name][COLLECTION_NAME]

    if json_data == "":
        return ""
    

    if (duplicatesInput == "NoDupes"):
        no_dupes = []
        #print(json_data)
        for i in json_data:
            if i not in no_dupes:
                no_dupes.append(i)
        
        collection.insert_many(no_dupes)
    else:
        collection.insert_many(json_data)

    connection.close()

                                </script>
                            </code>
                        </pre>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingFour">
                    <h5 class="mb-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                            XML
                        </button>
                    </h5>
                </div>
                <div id="collapseFour" class="collapse" aria-labelledby="headingFour"
                     data-parent="#accordionExample">
                    <div class="card-body">
                        <pre>
                            <code  class="language-javascript">
                            <script type="prism-python">
                                import xml.etree.ElementTree as ET

from pymongo import MongoClient


def xml_upload(uploaded_file, path_to_file, duplicatesInput, DB_HOST, DB_PORT, DB_Name):
    # Define constants
    COLLECTION_NAME = uploaded_file.split('.')[0]
    # print(COLLECTION_NAME)

    connection = MongoClient(DB_HOST, DB_PORT)

    collection = connection[DB_Name][COLLECTION_NAME]

    with open(path_to_file + "/" + uploaded_file) as xml_file:  # Open targeted file
        tree = ET.parse(path_to_file + "/" + uploaded_file)
        # print(tree)

        root = tree.getroot()
        # print(rootName)

        elementName = root[0].tag
        # print(elementName)

        stud = tree.findall(elementName)
        for i in stud:
            print(i)

        childTags = []
        for child in stud[1]:
            childTags.append(child.tag)

        # for item in childTags:
        #    print(item)

        if (duplicatesInput == "NoDupes"):
            no_dupes = []
            for rows in stud:
                data_dict = {}
                for cols in childTags:
                    data_dict[cols] = rows.find(cols).text

                if data_dict not in no_dupes:
                    no_dupes.append(data_dict)
                
            collection.insert_many(no_dupes)
        else:
            for rows in stud:
                data_dict = {}
                for cols in childTags:
                    data_dict[cols] = rows.find(cols).text
                collection.insert(data_dict)

        xml_file.close()  # Close XML file to reduce the risk of being unwarranted modified or read.
        connection.close()

                                </script>
                            </code>
                        </pre>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<div class="tab-pane fade" id="pills-visualizations" role="tabpanel" aria-labelledby="pills-visualizations-tab">
    <hr/>
    <h1>D3 Visualizations</h1>
    <p>I created 2 D3 visualizations that are generated when a user uploads a file. One is a scatterplot and one is a barchart</p>
    <div class="accordion" id="accordionGuide">
        <div class="card">
            <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseScatter"
                            aria-expanded="true" aria-controls="collapseScatter">
                        Scatter Plot
                    </button>
                </h5>
            </div>

            <div id="collapseScatter" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionGuide">
                <div class="card-body">
                    <div class="description">
                        <pre>
                            <code  class="language-javascript">
                            <script type="prism-javascript">
                                var margin = {top: 10, right: 20, bottom: 30, left: 50},
width = 1000 - margin.left - margin.right,
height = 420 - margin.top - margin.bottom;

let xVar;
let xMin;
let xMax;
let yVar;
let yMin;
let yMax;
let zVar;
let zMin;
let zMax;
let dimensions;

d3.queue()
    .defer(d3.json, "/donorschoose/manualcharts")
    .defer(d3.json, "/donorschoose/scatterplotdimensions")
    .await(drawChart)

// append the svg object to the body of the page
var svg = d3.select("#scatterplot")
.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
.append("g")
    .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");



function drawChart(error, data2, data3) {

    console.log(data2)
    console.log(data3)
    xVar = data2.x;
    xMin = data2.xMin;
    xMax = data2.xMax;
    yVar = data2.y;
    yMin = data2.yMin;
    yMax = data2.yMax;
    zVar = data2.z;
    zMin = data2.zMin;
    zMax = data2.zMax;
    //bool1 = true;

    dimensions = data3;
    //bool2 = true;

    console.log("x: " + xVar);
    console.log("y: " + yVar);
    console.log("z: " + zVar);

    d3.json("/donorschoose/scatterplot", function(data) {

        // Add X axis
        var x = d3.scaleLinear()
            .domain([xMin, xMax])
            .range([ 0, width ]);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));
        
        // Add Y axis
        var y = d3.scaleLinear()
            .domain([yMin, yMax])
            .range([ height, 0]);
        svg.append("g")
            .call(d3.axisLeft(y));
        
        // Add a scale for bubble size
        var z = d3.scaleLinear()
            .domain([zMin, zMax])
            .range([ 4, 15]);
        
        //Add a scale for bubble color
        var myColor = d3.scaleOrdinal()
            .domain([zMin, zMax])
            .range(d3.schemeSet2);
        
        // -1- Create a tooltip div that is hidden by default:
        var tooltip = d3.select("#scatterplot")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color", "black")
            .style("border-radius", "5px")
            .style("padding", "10px")
            .style("color", "white")
        
        // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
        var showTooltip = function(d) {
            tooltip
            .transition()
            .duration(200)
            tooltip
            .style("opacity", 1)
            .html(dimensions[0] + " " + d[dimensions[0]] + " " + zVar + ": " + d[zVar])
            .style("left", (d3.mouse(this)[0]+60) + "px")
            .style("top", (d3.mouse(this)[1]+60) + "px")
        }
        var moveTooltip = function(d) {
            tooltip
            .style("left", (d3.mouse(this)[0]+200) + "px")
            .style("top", (d3.mouse(this)[1]+200) + "px")
        }
        var hideTooltip = function(d) {
            tooltip
            .transition()
            .duration(200)
            .style("opacity", 0)
        }
        
        // Add dots
        svg.append('g')
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
            .attr("class", "bubbles")
            .attr("cx", function (d) { return x(d[xVar]); } )
            .attr("cy", function (d) { return y(d[yVar]); } )
            .attr("r", function (d) { return z(d[zVar]); } )
            .style("fill", function (d) { return myColor(d[zVar]); } )
            // -3- Trigger the functions
            .on("mouseover", showTooltip )
            .on("mousemove", moveTooltip )
            .on("mouseleave", hideTooltip )
        
    })
}
                                            </script>
                                        </code>
                                    </pre>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingFour">
                    <h5 class="mb-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                data-target="#collapseBarchart" aria-expanded="false" aria-controls="collapseBarchart">
                            Bar Chart
                        </button>
                    </h5>
                </div>
                <div id="collapseBarchart" class="collapse" aria-labelledby="collapseBarchart"
                     data-parent="#accordionExample">
                    <div class="card-body">
                        <pre>
                            <code  class="language-javascript">
                            <script type="prism-python">
                                // set the dimensions and margins of the graph
var margin1 = {top: 10, right: 30, bottom: 90, left: 40},
    width1 = 1000 - margin1.left - margin1.right,
    height1 = 450 - margin1.top - margin1.bottom;

d3.queue()
    .defer(d3.json, "/donorschoose/manualcharts")
    .defer(d3.json, "/donorschoose/scatterplotdimensions")
    .defer(d3.json, "/donorschoose/scatterplot")
    .await(drawChart)

// append the svg object to the body of the page
var svg1 = d3.select("#barchart")
  .append("svg")
    .attr("width", width1 + margin1.left + margin1.right)
    .attr("height", height1 + margin1.top + margin1.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin1.left + "," + (margin1.top) + ")");

// Parse the Data
function drawChart(error, data2, data3, data) {
    console.log(data2)
    console.log(data3)
    xVar = data2.x;
    xMin = data2.xMin;
    xMax = data2.xMax;
    yVar = data2.y;
    yMin = data2.yMin;
    yMax = data2.yMax;
    zVar = data2.z;
    zMin = data2.zMin;
    zMax = data2.zMax;
    //bool1 = true;

    dimensions = data3;
    //bool2 = true;

    console.log("x: " + xVar);
    console.log("y: " + yVar);
    console.log("z: " + zVar);

    // X axis
    var x = d3.scaleBand()
    .range([ 0, width1 ])
    .domain(data.map(function(d) { return d[xVar]; }))
    .padding(0.2);
    svg1.append("g")
    .attr("transform", "translate(0," + height1 + ")")
    .call(d3.axisBottom(x))
    .selectAll("text")
        .attr("transform", "translate(-10,0)rotate(-45)")
        .style("text-anchor", "end");

    // Add Y axis
    var y = d3.scaleLinear()
    .domain([0, yMax])
    .range([ height1, 0]);
    svg1.append("g")
    .call(d3.axisLeft(y));

    var tooltip1 = d3.select("#barchart")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "black")
    .style("border-radius", "5px")
    .style("padding", "10px")
    .style("color", "white")

    var showTooltip = function(d) {
        tooltip1
        .transition()
        .duration(200)
        tooltip1
        .style("opacity", 1)
        .html(dimensions[0] + " " + d[dimensions[0]] + " " + zVar + ": " + d[zVar])
        .style("left", (d3.mouse(this)[0]+60) + "px")
        .style("top", (d3.mouse(this)[1]+60) + "px")
    }
    var moveTooltip = function(d) {
        tooltip1
        .style("left", (d3.mouse(this)[0]+250) + "px")
        .style("top", (d3.mouse(this)[1]+670) + "px")
    }
    var hideTooltip = function(d) {
        tooltip1
        .transition()
        .duration(200)
        .style("opacity", 0)
    }

    // Bars
    svg1.selectAll("mybar")
    .data(data)
    .enter()
    .append("rect")
        .attr("x", function(d) { return x(d[xVar]); })
        .attr("width", x.bandwidth())
        .attr("fill", "#69b3a2")
        // no bar at the beginning thus:
        .attr("height", function(d) { return height1 - y(0); }) // always equal to 0
        .attr("y", function(d) { return y(0); })
        .on("mouseover", showTooltip )
        .on("mousemove", moveTooltip )
        .on("mouseleave", hideTooltip )
    
    // Animation
    svg1.selectAll("rect")
    .transition()
    .attr("y", function(d) { return y(d[yVar]); })
    .attr("height", function(d) { return height1 - y(d[yVar]); })
    .delay(function(d,i){console.log(i) ; return(i*100)})

}
                                </script>
                            </code>
                        </pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="tab-pane fade" id="pills-datagathering" role="tabpanel" aria-labelledby="pills-datagathering-tab">
    <hr/>
    <h1>Data Gathering for Visualizations</h1>
    <p>The first step was to get a list of columns and analyze which ones were categorical or numeric.</p><br>
    <h3>AnalyzeData.py</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                import csv
                from numpy import equal
                import pandas as pd
                from collections import OrderedDict, Counter
                from pymongo import MongoClient
                
                def analyze_data(uploaded_file, path_to_file, DB_HOST, DB_PORT, DB_Name):
                    print(uploaded_file)
                    print(path_to_file)
                
                    #open connection
                    COLLECTION_NAME = uploaded_file.split('.')[0]
                    connection = MongoClient(DB_HOST, DB_PORT)
                    collection = connection[DB_Name][COLLECTION_NAME]
                
                    SINGLEFIELDS = {"_id" : False}
                    list_of_columns = []
                    oneRow = collection.find_one(projection=SINGLEFIELDS)
                    for i in oneRow:
                        list_of_columns.append(i)
                
                    analyzed_columns = {}
                    for col in list_of_columns:
                        #print("\n")
                        FIELDS = {col: True}
                        testCol = collection.find(projection=FIELDS)
                
                        #isolate values from database for analysis
                        column = []
                        is_measure = True
                        for i in testCol:
                            row = []
                            for value in i.values():
                                row.append(value)
                            column.append(row[-1])
                        for each in column:
                            try:
                                #print(each)
                                float(each)
                                #print("Measure")
                            except:
                                is_measure = False
                                #print(each)
                                #print("Dimension")
                                analyzed_columns[col] = "dimension"
                                break
                        if is_measure:
                            analyzed_columns[col] = "measure"
                    
                    print("\n")
                    
                    largest_average = 0
                    largest_average_variable = ""
                    for analyzed in analyzed_columns.items():
                        current_average = 0
                        counter = 0
                        if(analyzed[1] == "measure" and analyzed[0] != "ID"):
                            FIELD = {analyzed[0] : True, "_id" : False}
                            vals = collection.find(projection = FIELD)
                            for i in vals:
                                for j in i.values():
                                    current_average += float(j)
                                    counter += 1
                            current_average /= counter
                        if (current_average > largest_average):
                            largest_average = current_average
                            largest_average_variable = analyzed[0]
                        
                    analyzed_columns[largest_average_variable] = "largestMeasure"
                    connection.close()
                    return analyzed_columns
    
            </script>
        </code>
    </pre><br>
    <p>Then we get the measures and dimensions</p><br>
    <h3>Measures</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                @app.route("/donorschoose/scatterplotmeasures")
                def donorschoose_scatterplot_measures():
                    connection = MongoClient(MONGODB_HOST, MONGODB_PORT)
                    file_name_call = get_filename()
                    collection = connection[DBS_NAME][file_name_call]
                    app.logger.debug('FILE NAMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE' + file_name_call)
                    var1 = ""
                    var2 = ""
                    xVar = ""
                    yVar = ""
                    var1Max = ""
                    var2Max = ""
                    var2Min = ""
                    var1Min = ""
                    ################ var1 & var2 values #################
                    columns = get_columns()
                    app.logger.debug("no is a purple dinosaur")
                    for i in columns.items():
                        app.logger.debug(i)
                        if (i[1] == "measure"):
                            if (var1 == ""):
                                var1 = i[0]
                                app.logger.debug(
                                    'column NAMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE' + i[0])
                            else:
                                var2 = i[0]
                                app.logger.debug(
                                    'column NAMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE' + i[0])

                    if (var1 != ""):
                        app.logger.debug('in this if so var1 not null')
                        var1field = {var1: True, "_id": False}
                        var1Val = collection.find(projection=var1field).sort(var1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var1Val:
                            for j in i.values():
                                var1Min = j
                        var1Val = collection.find(projection=var1field).sort(var1, -1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var1Val:
                            for j in i.values():
                                var1Max = j
                    if (var2 != ""):
                        app.logger.debug('in this if so var2 not null')
                        var2field = {var2: True, "_id": False}
                        var2Val = collection.find(projection=var2field).sort(var2).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var2Val:
                            for j in i.values():
                                var2Min = j
                        var2Val = collection.find(projection=var2field).sort(var2, -1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var2Val:
                            for j in i.values():
                                var2Max = j
                    ###########################################

                    if (var1Max > var2Max):
                        yVar = var1
                        yMax = var1Max
                        yMin = var1Min
                        xVar = var2
                        xMax = var2Max
                        xMin = var2Min
                    else:
                        yVar = var2
                        yMax = var2Max
                        yMin = var2Min
                        xVar = var1
                        xMax = var1Max
                        xMin = var1Min

                    ################ z values #################
                    zVar = ""
                    zMax = ""
                    for i in columns.items():
                        if (i[1] == "largestMeasure"):
                            zVar = i[0]

                    zfield = {zVar: True, "_id": False}
                    zVal = collection.find(projection=zfield).sort(zVar).collation({'locale': "en_US", 'numericOrdering': True}).limit(1)
                    for i in zVal:
                        for j in i.values():
                            zMin = j
                    zVal = collection.find(projection=zfield).sort(zVar, -1).collation(
                        {'locale': "en_US", 'numericOrdering': True}).limit(1)
                    for i in zVal:
                        for j in i.values():
                            zMax = j
                    ###########################################
                    print("X: " + xVar + " Max: " + xMax + " Min: " + xMin)
                    print("Y: " + yVar + " Max: " + yMax + " Min: " + yMin)
                    print("Z: " + zVar + " Max: " + zMax + " Min: " + zMin)
                    data = {"x": xVar, "xMin": xMin, "xMax": xMax, "y": yVar, "yMin": yMin, "yMax": yMax, "z": zVar, "zMin": zMin,
                            "zMax": zMax}

                    json_data = json.dumps(data, default=json_util.default)
                    connection.close()
                    return json_data

    
            </script>
        </code>
    </pre><br>
    <h3>Dimensions</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                @app.route("/donorschoose/scatterplotdimensions")
                def donorschoose_scatterplot_dimensions():
                    app.logger.info("test log")
                    #columns = analyze_data(filename, app.config["UPLOAD_FOLDER"], MONGODB_HOST, MONGODB_PORT, DBS_NAME)
                    columns = get_columns()

                    dimensions = []
                    for i in columns.items():
                        if (i[1] == "dimension"):
                            dimensions.append(i[0])
                    json_data = json.dumps(dimensions, default=json_util.default)
                    # print(json_data)
                    return json_data
            </script>
        </code>
    </pre><br>
    <p>We can also get the measures automatically.</p>
    <h3>Auto Measures</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                @app.route("/donorschoose/scatterplotmeasures")
                def donorschoose_scatterplot_measures():
                    connection = MongoClient(MONGODB_HOST, MONGODB_PORT)
                    file_name_call = get_filename()
                    collection = connection[DBS_NAME][file_name_call]
                    app.logger.debug('FILE NAME' + file_name_call)
                    var1 = ""
                    var2 = ""
                    xVar = ""
                    yVar = ""
                    var1Max = ""
                    var2Max = ""
                    var2Min = ""
                    var1Min = ""
                    ################ var1 & var2 values #################
                    columns = get_columns()
                    app.logger.debug("no is a purple dinosaur")
                    for i in columns.items():
                        app.logger.debug(i)
                        if (i[1] == "measure"):
                            if (var1 == ""):
                                var1 = i[0]
                                app.logger.debug(
                                    'column NAME' + i[0])
                            else:
                                var2 = i[0]
                                app.logger.debug(
                                    'column NAME' + i[0])

                    if (var1 != ""):
                        app.logger.debug('in this if so var1 not null')
                        var1field = {var1: True, "_id": False}
                        var1Val = collection.find(projection=var1field).sort(var1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var1Val:
                            for j in i.values():
                                var1Min = j
                        var1Val = collection.find(projection=var1field).sort(var1, -1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var1Val:
                            for j in i.values():
                                var1Max = j
                    if (var2 != ""):
                        app.logger.debug('in this if so var2 not null')
                        var2field = {var2: True, "_id": False}
                        var2Val = collection.find(projection=var2field).sort(var2).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var2Val:
                            for j in i.values():
                                var2Min = j
                        var2Val = collection.find(projection=var2field).sort(var2, -1).collation(
                            {'locale': "en_US", 'numericOrdering': True}).limit(1)
                        for i in var2Val:
                            for j in i.values():
                                var2Max = j
                    ###########################################

                    if (var1Max > var2Max):
                        yVar = var1
                        yMax = var1Max
                        yMin = var1Min
                        xVar = var2
                        xMax = var2Max
                        xMin = var2Min
                    else:
                        yVar = var2
                        yMax = var2Max
                        yMin = var2Min
                        xVar = var1
                        xMax = var1Max
                        xMin = var1Min

                    ################ z values #################
                    zVar = ""
                    zMax = ""
                    for i in columns.items():
                        if (i[1] == "largestMeasure"):
                            zVar = i[0]

                    zfield = {zVar: True, "_id": False}
                    zVal = collection.find(projection=zfield).sort(zVar).collation({'locale': "en_US", 'numericOrdering': True}).limit(1)
                    for i in zVal:
                        for j in i.values():
                            zMin = j
                    zVal = collection.find(projection=zfield).sort(zVar, -1).collation(
                        {'locale': "en_US", 'numericOrdering': True}).limit(1)
                    for i in zVal:
                        for j in i.values():
                            zMax = j
                    ###########################################
                    print("X: " + xVar + " Max: " + xMax + " Min: " + xMin)
                    print("Y: " + yVar + " Max: " + yMax + " Min: " + yMin)
                    print("Z: " + zVar + " Max: " + zMax + " Min: " + zMin)
                    data = {"x": xVar, "xMin": xMin, "xMax": xMax, "y": yVar, "yMin": yMin, "yMax": yMax, "z": zVar, "zMin": zMin,
                            "zMax": zMax}

                    json_data = json.dumps(data, default=json_util.default)
                    connection.close()
                    return json_data
            </script>
        </code>
    </pre><br>
    <p>We also get the user input to see what variables they want to use for their visualizations.</p>
    <h3>User Input</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                <head>
                    <form action="/get_chart_variables" method="post">
                      <br><br>
                      <table>
                        <th>
                          <label for="x">Choose X variable:</label>
                          <select name="x" id="x"></select>
                        </th>
                        <th>
                          <label for="y">Choose Y variable:</label>
                          <select name="y" id="y"></select>
                        </th>
                        <th>
                          <label for="z">Choose Z variable:</label>
                          <select name="z" id="z"></select>
                        </th>
                      </table>
                      <input type="submit" value="Create Visualizations">
                    </form>
                    <script type="text/javascript">
                      var page_url = document.location.href;
                      var url = new URL(page_url);
                      var measures = url.searchParams.get("measures");
                      const array = measures.split(",");
                      var xoptions = "";
                      var yoptions = "";
                      var zoptions = "";
                      for(i = 0; i < array.length; i++) {
                        xoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                      }
                      document.getElementById('x').innerHTML = xoptions;
                      for(i = 0; i < array.length; i++) {
                        yoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                      }
                      document.getElementById('y').innerHTML = xoptions;
                      for(i = 0; i < array.length; i++) {
                        zoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                      }
                      document.getElementById('z').innerHTML = xoptions;
                    /script>
                  /head>
            </script>
        </code>
    </pre><br>
</div>
<div class="tab-pane fade" id="pills-displayingvisuals" role="tabpanel" aria-labelledby="pills-displayingvisuals-tab">
    <hr/>
    <h1>Displaying Data and Visualizations</h1>
    <p>we first display the data on the successful upload page. Here the user can view automatically generated <br>
        scatter plots using python and an indepth analysis of their data using pandas profiling. Then the user <br>
        selects their variables which genertates the D3.js visualizations</p><br>
    <h3>Auto Scatter Plots</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-python">
                @app.route("/donorschoose/scatterplotmatplotlib")
                def donorschoose_scatterplot_matplotlib():
                    columns = get_columns()
                    image_name = get_filename()

                    fig = plt.figure()

                    np.random.seed(19680801)
                    N = 50
                    xVar = ""
                    yVar = ""
                    area = 10
                    measureList = []
                    plot_counter = 0
                    colors = np.random.rand(N)
                    for i in columns.items():
                        if (i[1] == "measure"):
                            yVar = i[0]
                            measureList.append(i[0])
                        if (i[1] == "largestMeasure"):
                            xVar = i[0]
                            measureList.append(i[0])

                    possible_plots = len(measureList) * len(measureList)
                    plot_position = 0

                    connection = MongoClient(MONGODB_HOST, MONGODB_PORT)
                    collection = connection[DBS_NAME][file_name]

                    for eachx in measureList:
                        for eachy in measureList:
                            plot_counter += 1
                            plotx = 0
                            ploty = 0
                            num_rows = np.ceil(possible_plots / 5)
                            fig.tight_layout()
                            fig.set_size_inches(15, num_rows * 2.5)

                            temp = fig.add_subplot(num_rows, 5, plot_counter)
                            XYFIELDS = {eachx: True, eachy: True, "_id": False}
                            xyData = collection.find(projection=XYFIELDS)

                            xArray = []
                            yArray = []

                            for row in xyData:
                                xArray.append(float(row[eachx]))
                                yArray.append(float(row[eachy]))

                            temp.scatter(xArray, yArray, s=area, c="g", alpha=1)
                            temp.set(xlabel=eachx, ylabel=eachy)

                    try:
                        os.remove('/mnt/c/Users/Hamza/Desktop/Data2Int-GitHub/Data2Int/html/static/'+ image_name + '.png')
                        #os.remove("/var/www/data2int.com/html/static/scatter.png")
                    except:
                        print("Nothing to remove")
                    fig.savefig('/mnt/c/Users/Hamza/Desktop/Data2Int-GitHub/Data2Int/html/static/'+ image_name + '.png')
                    #fig.savefig('/var/www/data2int.com/html/static/'+ image_name + '.png')
                    json_data = json.dumps(columns, default=json_util.default)
                    connection.close()

            </script>
        </code>
    </pre><br>
    <h3>Successful Upload</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-html-markup">
                <script src="https://code.jquery.com/jquery-3.1.1.min.js">/script>
                <script src="https://d3js.org/d3.v4.min.js">/script>
                <script src="https://d3js.org/d3-scale-chromatic.v1.min.js">/script>
                <div>
                <iframe src="url_for('pandas_generated_report', filename=collection_name)}}" title="Pandas Profiling Report" style="width:1510px;height:600px"></iframe><br>
                <img src="url_for('static', filename=collection_name + '.png')}}" alt="ScatterPlot" style="border: 5px solid black">
                </iframe>
                <head>
                    <form action="/get_chart_variables" method="post">
                    <br><br>
                    <table>
                        <th>
                        <label for="x">Choose X variable:</label>
                        <select name="x" id="x"></select>
                        </th>
                        <th>
                        <label for="y">Choose Y variable:</label>
                        <select name="y" id="y"></select>
                        </th>
                        <th>
                        <label for="z">Choose Z variable:</label>
                        <select name="z" id="z"></select>
                        </th>
                    </table>
                    <input type="submit" value="Create Visualizations">
                    </form>
                    <script type="text/javascript">
                    var page_url = document.location.href;
                    var url = new URL(page_url);
                    var measures = url.searchParams.get("measures");
                    const array = measures.split(",");
                    var xoptions = "";
                    var yoptions = "";
                    var zoptions = "";
                    for(i = 0; i < array.length; i++) {
                        xoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('x').innerHTML = xoptions;
                    for(i = 0; i < array.length; i++) {
                        yoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('y').innerHTML = xoptions;
                    for(i = 0; i < array.length; i++) {
                        zoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('z').innerHTML = xoptions;
                    /script>
                </head>
                <br><br><br>
                </div>
                <div id="scatterplot">
                </div>
                <style>
                    .bubbles {
                    stroke-width: 2px;
                    stroke: white;
                    }
                    .bubbles:hover {
                    stroke: black;
                    }
                </style>
                <!-- <script src="/static/js/scatterPlot.js">/script> -->
                </div>
            </script>
        </code>
    </pre><br>
    <h3>Visualizations</h3>
    <pre>
        <code  class="language-javascript">
            <script type="prism-html-markup">
                <script src="/static/lib/js/jquery.min.js">/script>
                <head>
                    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
                    <meta http-equiv="Pragma" content="no-cache" />
                    <meta http-equiv="Expires" content="0" />
                </head>
                <div class="loader-wrapper">
                    <span class="loader"><span class="loader-inner"></span></span>
                </div>
                <script>
                    $(document).ready(function($){
                    $(".loader-wrapper").fadeOut(1500);
                    });
                /script>
                <h1>SUCCESS!</h1>
                <h2>The file: {{collection_name}} was uploaded successfully.</h2>
                <hr/>

                {% for table in tables %}
                {{ table|safe }}
                {% endfor %}

                <script src="https://code.jquery.com/jquery-3.1.1.min.js">/script>
                <script src="https://d3js.org/d3.v4.min.js">/script>
                <script src="https://d3js.org/d3-scale-chromatic.v1.min.js">/script>
                <div>
                    <div id="scatterplot">
                    </div><br>
                    <style>
                        .bubbles {
                        stroke-width: 2px;
                        stroke: white;
                        }
                        .bubbles:hover {
                        stroke: black;
                        }
                    </style><br>
                    <div id="barchart">
                    </div>
                </div>
                <script src="/static/js/manualScatterPlot.js">/script>
                <script src="/static/js/barchart.js">/script>
                <head>
                    <h2>Redraw Visualizations</h2>
                    <form action="/get_chart_variables" method="post">
                    <table>
                        <th>
                        <label for="x">Choose X variable:</label>
                        <select name="x" id="x"></select>
                        </th>
                        <th>
                        <label for="y">Choose Y variable:</label>
                        <select name="y" id="y"></select>
                        </th>
                        <th>
                        <label for="z">Choose Z variable:</label>
                        <select name="z" id="z"></select>
                        </th>
                    </table>
                    <input type="submit" value="Create Visualizations">
                    </form>
                    <script type="text/javascript">
                    var page_url = document.location.href;
                    var url = new URL(page_url);
                    var measures = url.searchParams.get("measures");
                    const array = measures.split(",");
                    var xoptions = "";
                    var yoptions = "";
                    var zoptions = "";
                    for(i = 0; i < array.length; i++) {
                        xoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('x').innerHTML = xoptions;
                    for(i = 0; i < array.length; i++) {
                        yoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('y').innerHTML = xoptions;
                    for(i = 0; i < array.length; i++) {
                        zoptions += "<option value='" + array[i] + "'>" + array[i] + "</option>";
                    }
                    document.getElementById('z').innerHTML = xoptions;
                    /script><br><br><br>
                    <iframe src="url_for('pandas_generated_report', filename=collection_name)}}" title="Pandas Profiling Report" style="width:1510px;height:600px"></iframe><br>
                    <img src="url_for('static', filename=collection_name + '.png')}}" alt="ScatterPlot" style="border: 5px solid black">
                </head>
                <br><br><br>
                </div>
            </script>
        </code>
    </pre><br>
</div>
</div>

{% endblock %}
